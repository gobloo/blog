---
layout: post
title: SPF - A simple explication
date: 01-11-2025
categories: [Notes]
tag: [Red Team, Blue Team, Phishing, Email Analysis]
---

# Understanding SPF (Sender Policy Framework) for Email Security

## What is SPF?

SPF stands for Sender Policy Framework. It is an email security method used to prevent spammers from sending emails pretending to be from your domain. SPF works by listing all the authorized servers that can send emails on behalf of your domain.

## Why is SPF Important?

SPF helps protect your email domain from spoofing and phishing attacks. When an email server receives a message from your domain, it checks the SPF record to verify if the sender's server is authorized. If not, the email can be marked as suspicious or rejected.

SPF is all about publishing a list of servers that are authorized to send on behalf of a domain.

## How Does SPF Work?

- SPF is a special DNS record for your domain.
- This record lists IP addresses and domains allowed to send your emails.
- When an email arrives, the receiver checks if the sender matches this list.
- If the sender is approved, the email passes the SPF check; otherwise, it can fail.

   ![SPF Worflow Diagram](https://raw.githubusercontent.com/gobloo/blog/refs/heads/main/_posts/EmailAnalysis/image.png)

## Creating an SPF Record

To create an SPF record, you:

1. Gather all servers that send email for your domain (including third-party services like mail providers).
2. Build an SPF record starting with `v=spf1`.
3. Add authorized IP addresses or domains using IP addresses (`ip4`, `ip6`) or `include` statements to authorize third parties.
4. End the record with a policy that tells email receivers how to handle unauthorized senders, such as:

   - `-all` means reject all emails not from authorized servers.
   - `~all` means accept but mark emails from unauthorized servers.

Example SPF record:
   ```
   v=spf1 ip4:40.113.200.201 ip6:2001:db8::1 include:thirdparty.com -all
   ```
## Where is SPF Published?

SPF records are published in your domain's DNS as `TXT records`.

## Important Notes on SPF Failures and Email Delivery

Discarding emails based on **SPF results** ended up causing **too many legitimate emails to be dropped**. This often happens because SPF records were improperly configured or because some vendors did not send SPF-compliant emails. Because of this, most email receivers use SPF results as input for anti-spam engines rather than outright rejecting emails. However, a few email providers still treat SPF "fail" as a strong signal to discard emails.

With the introduction of DMARC (another email security standard), receivers now use DMARC policies to decide how to handle emails that fail SPF or DKIM checks. In this context, the soft fail `~all` in SPF is treated similarly to the hard fail `-all` as "not pass."

## Tips for SPF Records

- Keep your SPF record under 255 characters.
- Limit include statements (lookups) to 10 or fewer.
- For domains that don't send email, use a record like `v=spf1 -all` to prevent abuse.

SPF is often used together with DKIM and DMARC, forming a strong trio to protect your domain from email spoofing and phishing.

---
> With an SPF record in place, you protect your email domain against spoofing and phishing attacks by letting the world know which servers are authorized to send authenticated email on your behalf.


