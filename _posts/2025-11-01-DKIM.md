---
layout: post
title: üìß DKIM - A simple explication
date: 01-11-2025
categories: [Notes]
tag: [Red Team, Blue Team, Phishing, Email Analysis]
---

# üìß Understanding DKIM (DomainKeys Identified Mail) for Email Security

## What is DKIM?

DKIM (DomainKeys Identified Mail) is an email security method that helps verify if an email was really sent by the owner of the domain and if the email content was not changed during transit. It uses a pair of cryptographic keys: a private key to sign outgoing emails and a public key published in the domain's DNS for verification.

## How DKIM Works

1. **Digital Signature Creation:** When you send an email, your server creates a unique digital signature based on the email's content (headers and body) with a private key.
2. **Adding the Signature:** This signature is added to the email as a special header called the DKIM-Signature.
3. **Email Transmission:** The email travels through the internet and may pass through several servers.
4. **Verification:** The receiver‚Äôs email server extracts the DKIM-Signature, retrieves your public key from DNS under a specific selector, and checks if the signature matches the email content.
5. **Authentication Check:** If the signature matches, it confirms the email is genuine and unchanged during transit. The signing domain must match the domain in the email‚Äôs From address to prevent spoofing.
    ![DKIM Workflow Diagram](https://raw.githubusercontent.com/gobloo/blog/refs/heads/main/_posts/EmailAnalysis/image-1.png)

## What is a DKIM Selector?

A DKIM selector is a name that helps the receiving server find the correct public key in your DNS. Organizations can have multiple selectors for different servers or services sending email.

## Finding Your DKIM Selector

You can find your DKIM selector by looking at the email headers in popular email clients like Gmail or Outlook, searching for the "DKIM-Signature" header and locating the `s=` tag which holds the selector value.

## How to Create a DKIM Record

Creating a DKIM record involves generating a cryptographic key pair and publishing the public key in your domain‚Äôs DNS as a TXT record.

### Steps to Create Your DKIM Record

1. **Generate DKIM Key Pair:**  
   - Use a tool provided by your email service provider or an online DKIM key generator to create a private key and a public key.
   - The private key stays on your mail server to sign outgoing emails.
   - The public key is published in your DNS for verification by receiving servers.

2. **Choose a DKIM Selector:**  
   - The selector is a simple name (like `default` or `google`) that helps identify the correct DKIM key if you use multiple keys.
   
3. **Create the DKIM DNS TXT Record:**  
   - Format the record name as: `<selector>._domainkey.<yourdomain.com>`  
     Example: `default._domainkey.example.com`
   - The record type is `TXT`.
   - The record value contains your DKIM public key and looks like this:
        ```
        v=DKIM1; k=rsa; p=your_public_key_here
        ```
    - Replace `your_public_key_here` with the actual public key string from your key pair.

4. **Add the DKIM Record to Your DNS:**  
- Log in to your domain registrar or DNS provider.
- Go to DNS management and add the new TXT record with the name and value from step 3.
- Save the changes and wait for DNS propagation.

5. **Enable DKIM Signing in Your Mail Server or Email Service:**  
- Configure your mail server or ESP to use the private key to sign outgoing emails using the same selector.

6. **Verify Your DKIM Setup:**  
- Use online DKIM verification tools or send test emails and check the headers for a valid DKIM signature.

### Example DKIM TXT Record
```bash
    Type: TXT
    Name: default._domainkey.example.com
    Value: v=DKIM1; k=rsa; p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDlK9...
    TTL: 3600
```



## Publishing DKIM Records in DNS

There are two common ways to publish your DKIM public key:

- **TXT Record:** Stores the actual DKIM public key in your domain‚Äôs DNS.
- **CNAME Record:** Points to a key managed by a third-party provider, useful for easy key rotation.

Always follow your email provider‚Äôs instructions to add DKIM DNS records properly and verify they are working.

---

> üèÅ *Using DKIM helps ensure your emails are trusted and are less likely to be marked as spam or spoofed.*
